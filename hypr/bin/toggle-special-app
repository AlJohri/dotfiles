#!/bin/bash
# Toggle a window between a special workspace and the current workspace
# Usage: toggle-special-app <class_regex> <special_workspace_name> [launch_command]

CLASS="$1"
SPECIAL_WS="$2"
LAUNCH_CMD="$3"

if [ -z "$CLASS" ] || [ -z "$SPECIAL_WS" ]; then
    echo "Usage: toggle-special-app <class_regex> <special_workspace_name> [launch_command]"
    exit 1
fi

# Find window by class (case-insensitive regex match)
WINDOW_INFO=$(hyprctl clients -j | jq -r --arg class "$CLASS" '.[] | select(.class | test($class; "i"))')

if [ -z "$WINDOW_INFO" ]; then
    if [ -n "$LAUNCH_CMD" ]; then
        exec $LAUNCH_CMD
    else
        echo "No window matching class '$CLASS' found"
        exit 1
    fi
fi

ADDRESS=$(echo "$WINDOW_INFO" | jq -r '.address' | head -1)
WORKSPACE=$(echo "$WINDOW_INFO" | jq -r '.workspace.name' | head -1)

# Get current workspace
CURRENT_WS=$(hyprctl activeworkspace -j | jq -r '.name')

if [ "$WORKSPACE" = "special:$SPECIAL_WS" ]; then
    # Window is in special workspace, bring to current workspace and focus
    hyprctl dispatch movetoworkspace +0,address:$ADDRESS
    hyprctl dispatch focuswindow address:$ADDRESS
elif [ "$WORKSPACE" = "$CURRENT_WS" ]; then
    # Window is on current workspace, move to special workspace (hide)
    hyprctl dispatch movetoworkspacesilent special:$SPECIAL_WS,address:$ADDRESS
else
    # Window is on a different workspace, bring to current workspace and focus
    hyprctl dispatch movetoworkspace +0,address:$ADDRESS
    hyprctl dispatch focuswindow address:$ADDRESS
fi
