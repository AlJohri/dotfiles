# Extra autostart processes
# Note: This is not all apps autostarted by Hyprland! Omarchy has its own list at
# ~/.local/share/omarchy/default/hypr/autostart.conf
# Both that file and this one (~/.config/hypr/autostart.conf) are sourced in
# ~/.config/hypr/hyprland.conf
#
# exec-once = uwsm app -- my-service

# Restart waybar on reload to fix broken IPC connection.
#
# Omarchy starts waybar with `exec-once = uwsm-app -- waybar`, which only runs
# at initial startup. When `hyprctl reload` runs, Hyprland's IPC socket gets
# disrupted and waybar loses its connection, leaving it in a broken state.
#
# This `exec` runs on every reload (and startup). The `pgrep` check ensures we
# only restart if waybar is already running, so on initial startup this does
# nothing and omarchy's exec-once starts waybar normally. On reload, we kill
# the broken waybar and start a fresh one with a new IPC connection.
exec = pgrep -x waybar && (pkill -x waybar; sleep 0.2; uwsm-app -- waybar &)
exec-once = sh -c 'while true; do wayvnc 0.0.0.0; sleep 5; done'
